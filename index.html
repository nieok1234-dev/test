<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Walentynki üíñ</title>
<style>
  :root{
    --bg: linear-gradient(135deg,#ff758c,#ff7eb3);
  }
  *{box-sizing:border-box}
  body{margin:0;height:100vh;overflow:hidden;background:var(--bg);font-family:"Comic Sans MS",cursive,Arial}
  .page{position:absolute;inset:0;display:none}
  .page.active{display:block}
  .center-wrap{position:relative;z-index:20;height:100%;display:flex;align-items:center;justify-content:center}
  /* wiƒôksze serduszko w ≈õrodku - wyglƒÖd "jak wcze≈õniej" */
  .heart-large{
    width:220px;height:220px;border-radius:50%;background:#e33;color:#fff;display:flex;
    align-items:center;justify-content:center;flex-direction:column;font-weight:900;
    box-shadow:0 12px 40px rgba(0,0,0,0.28);cursor:pointer;transition:transform .25s ease,all .4s;
    transform:translateZ(0);
    font-size:44px;
  }
  .heart-medium{
    width:150px;height:150px;border-radius:50%;background:#e33;color:#fff;display:flex;
    align-items:center;justify-content:center;flex-direction:column;font-weight:800;
    box-shadow:0 10px 30px rgba(0,0,0,0.24);cursor:pointer;transition:all .35s;
    font-size:30px;
  }
  .heart-text{line-height:1;margin:0;padding:0}
  .subtext{font-size:14px;margin-top:8px;color:#fff;opacity:.95}
  .controls{display:flex;gap:12px;justify-content:center;align-items:center;margin-top:8px}
  .btn{padding:10px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:800}
  .btn-green{background:#2fbf4f;color:#fff}
  .btn-red{background:#e63946;color:#fff}
  /* falling elements */
  .fall-layer{position:absolute;inset:0;pointer-events:none;z-index:5;overflow:hidden}
  .fall{position:absolute;top:-90px;pointer-events:none;user-select:none;animation:fall linear forwards;opacity:0.95;text-shadow:0 2px 6px rgba(0,0,0,0.2)}
  @keyframes fall{to{transform:translateY(110vh) rotate(360deg);opacity:0}}
  /* paint-like flowers */
  .flower{position:absolute;z-index:6;pointer-events:none;opacity:.95}
  /* full-screen TAK when reached */
  .full-tak{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;background:rgba(255,20,80,0.98);z-index:9999;color:#fff;font-weight:900}
  /* cat gif */
  .cat-gif{position:fixed;right:12px;bottom:12px;width:240px;height:auto;z-index:10001;pointer-events:none}
  /* small messages that appear on "nie" clicks */
  .mini-msg{position:fixed;padding:6px 10px;border-radius:10px;background:rgba(0,0,0,0.2);color:#fff;font-weight:700;z-index:50;pointer-events:none}
</style>
</head>
<body>

<!-- PAGE 1 -->
<div id="p1" class="page active">
  <div class="fall-layer" id="fall1"></div>
  <div class="center-wrap">
    <div id="heart1" class="heart-large" title="Kliknij">
      <div class="heart-text">‚ù§Ô∏è</div>
      <div class="subtext">Przygotowa≈Çem co≈õ dla Ciebie</div>
    </div>
  </div>
  <div id="flowers1"></div>
</div>

<!-- PAGE 2 -->
<div id="p2" class="page">
  <div class="fall-layer" id="fall2"></div>
  <div class="center-wrap">
    <!-- zamiast ma≈Çego k√≥≈Çka, u≈ºywamy ≈õredniego serducha z tekstem w ≈õrodku -->
    <div id="magicHeart" class="heart-medium" style="position:relative;">
      <div id="mhText" class="heart-text">Jeszcze nie tu...</div>
      <div id="mhSub" class="subtext" style="font-size:12px;margin-top:6px">Teraz tutaj</div>
    </div>
  </div>
  <div id="flowers2"></div>
</div>

<!-- PAGE 3 -->
<div id="p3" class="page">
  <div class="fall-layer" id="fall3"></div>
  <div class="center-wrap">
    <div style="text-align:center;z-index:20">
      <div id="finalQ" style="color:#fff;font-size:30px;font-weight:900;margin-bottom:14px">Czy zostaniesz mojƒÖ walentynkƒÖ?</div>
      <div class="controls">
        <button id="yesBtn" class="btn btn-green" style="font-size:20px;padding:12px 20px">TAKK!!!</button>
        <button id="noBtn"  class="btn btn-red" style="font-size:20px;padding:12px 20px">nie</button>
      </div>
    </div>
  </div>
  <div id="flowers3"></div>
</div>

<!-- effects / final -->
<div id="effects" style="position:fixed;inset:0;pointer-events:none;z-index:800"></div>
<img id="catGif" class="cat-gif" src="" alt="" style="display:none"/>

<script>
/* ---------- utilities ---------- */
function rand(min,max){return min + Math.random()*(max-min)}
function createFalling(container, emoji, count, sizeRange=[16,36], durRange=[3.5,6]) {
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'fall';
    el.textContent = emoji;
    el.style.left = (Math.random()*94)+'vw';
    const fs = Math.round(rand(sizeRange[0], sizeRange[1]));
    el.style.fontSize = fs + 'px';
    el.style.animationDuration = rand(durRange[0], durRange[1]) + 's';
    el.style.opacity = (0.7 + Math.random()*0.3);
    container.appendChild(el);
    // cleanup after animation
    setTimeout(()=>{ if(el.parentNode) el.parentNode.removeChild(el); }, (durRange[1]+0.6)*1000);
  }
}
function createFlowers(container, emojis, count=18){
  for(let i=0;i<count;i++){
    const f = document.createElement('div');
    f.className = 'flower';
    f.textContent = emojis[Math.floor(Math.random()*emojis.length)];
    f.style.left = (Math.random()*86 + 6) + 'vw';
    f.style.top  = (Math.random()*78 + 6) + 'vh';
    f.style.fontSize = Math.round(rand(18,36)) + 'px';
    f.style.opacity = (0.75 + Math.random()*0.25);
    container.appendChild(f);
  }
}

/* ---------- page refs ---------- */
const p1 = document.getElementById('p1'), p2 = document.getElementById('p2'), p3 = document.getElementById('p3');
const fall1 = document.getElementById('fall1'), fall2 = document.getElementById('fall2'), fall3 = document.getElementById('fall3');
const flowers1 = document.getElementById('flowers1'), flowers2 = document.getElementById('flowers2'), flowers3 = document.getElementById('flowers3');
const effects = document.getElementById('effects'), catGif = document.getElementById('catGif');

/* ---------- populate flowers (different sets) ---------- */
createFlowers(flowers1, ['üå∏','üå∫','üå∑','üåº'], 20);
createFlowers(flowers2, ['üåª','üåπ','üåº','üå∫'], 20);
createFlowers(flowers3, ['üå∏','üå∑','üåπ','üå∫','üåº'], 22);

/* ---------- steady falling stream (keeps pages lively) ---------- */
function startStream(){
  createFalling(fall1,'‚ù§Ô∏è',12,[18,44],[3.5,5.8]);
  createFalling(fall1,'üå∏',6,[14,26],[4.2,6]);
  createFalling(fall2,'‚ù§Ô∏è',8,[16,36],[3.6,5.8]);
  createFalling(fall2,'‚ú®',6,[14,26],[3.4,5.4]);
  createFalling(fall3,'‚ù§Ô∏è',10,[18,38],[3.2,5.4]);
  createFalling(fall3,'‚ú®',8,[14,28],[3.2,5.2]);
}
startStream();
const streamTimer = setInterval(startStream, 1400);

/* ---------- page switch helper ---------- */
function showPage(n){ p1.classList.remove('active'); p2.classList.remove('active'); p3.classList.remove('active'); if(n==1) p1.classList.add('active'); if(n==2) p2.classList.add('active'); if(n==3) p3.classList.add('active'); }

/* ---------- PAGE 1: big heart -> go to page2 ---------- */
const heart1 = document.getElementById('heart1');
heart1.addEventListener('click', ()=>{
  heart1.style.transform = 'scale(0.98)';
  setTimeout(()=>heart1.style.transform='',220);
  showPage(2);
  initPage2();
});

/* ---------- PAGE 2: magic heart behavior (stable) ---------- */
let page2Inited = false;
function initPage2(){
  if(page2Inited) return;
  page2Inited = true;
  const magic = document.getElementById('magicHeart');
  const mhText = document.getElementById('mhText');
  const mhSub  = document.getElementById('mhSub');

  // allow absolute positioning for moves
  magic.style.position = 'absolute';
  magic.style.transition = 'all 0.55s cubic-bezier(.2,.9,.2,1)';

  let step = 0;
  const poems = [
    "Lena, Lenka, Lencia ‚Äî serduszko puka cicho",
    "Lencia m√≥j promyk dnia ‚Äî ≈õmiej siƒô tu ze mnƒÖ",
    "Lenka ‚Äî jak w piosence, wszystko dla Ciebie"
  ];

  magic.addEventListener('click', ()=>{
    step++;
    if(step === 1){
      // show poem, hide sub and move top-right
      mhText.textContent = poems[Math.floor(Math.random()*poems.length)];
      mhSub.style.display = 'none';
      magic.style.top = '6%';
      magic.style.right = '6%';
      magic.style.left = '';
      magic.style.bottom = '';
    } else if(step === 2){
      // bottom-left, show small subtext
      magic.style.top = '';
      magic.style.right = '';
      magic.style.left = '6%';
      magic.style.bottom = '6%';
      mhSub.style.display = 'block';
      mhSub.textContent = 'Oho i co teraz?';
    } else if(step === 3){
      // back to center, prepare last text
      magic.style.position = '';
      magic.style.top = '';
      magic.style.left = '';
      magic.style.right = '';
      magic.style.bottom = '';
      mhSub.style.display = 'block';
      mhSub.textContent = 'no dobra ale ostatnia rzecz';
    } else {
      // go to page 3
      showPage(3);
      initPage3();
    }
  });
}

/* ---------- PAGE 3: yes/no logic with growth and final ---------- */
let page3Inited = false;
function initPage3(){
  if(page3Inited) return;
  page3Inited = true;

  const yesBtn = document.getElementById('yesBtn');
  const noBtn  = document.getElementById('noBtn');

  let noClicks = 0;
  const messages = ["ale jak to","aha?","üòª","no wezzz"];

  function showMini(msg){
    const d = document.createElement('div');
    d.className = 'mini-msg';
    d.textContent = msg;
    d.style.left = (50 + rand(-20,20)) + '%';
    d.style.top  = (50 + rand(-20,20)) + '%';
    d.style.transform = 'translate(-50%,-50%)';
    d.style.opacity = '0';
    document.body.appendChild(d);
    setTimeout(()=>{ d.style.transition = 'all .18s ease'; d.style.opacity='1'; }, 10);
    setTimeout(()=>{ d.style.opacity='0'; }, 1800);
    setTimeout(()=>{ if(d.parentNode) d.parentNode.removeChild(d); }, 2400);
  }

  // clicking YES immediately triggers final
  yesBtn.addEventListener('click', ()=> {
    triggerFinalExplosion();
  });

  // clicking NO increments counter and grows YES button. after 8 clicks => full-screen TAK available
  noBtn.addEventListener('click', ()=>{
    noClicks++;
    // gently increase yes button size each time
    const curFS = parseFloat(window.getComputedStyle(yesBtn).fontSize);
    yesBtn.style.fontSize = (curFS + 4) + 'px';
    // show message sequence
    const msg = messages[Math.min(messages.length-1, noClicks-1)];
    showMini(msg);
    // when reach 8 clicks -> make TAK occupy full screen (replace p3 content)
    if(noClicks >= 8){
      makeFullTak();
    }
  });
}

/* ---------- replace p3 with full-screen TAK (clickable) ---------- */
function makeFullTak(){
  // remove falling and flowers in p3 (optional)
  clearChildren(fall3);
  clearChildren(flowers3);
  // clear page content
  p3.innerHTML = '';
  // big full TAK
  const full = document.createElement('div');
  full.className = 'full-tak';
  full.style.fontSize = '12vw';
  full.textContent = 'TAK!!!';
  document.body.appendChild(full);
  // clicking it triggers final explosion (and remove other elements)
  full.addEventListener('click', ()=> {
    triggerFinalExplosion();
  }, { once: true });
}

/* helper remove children */
function clearChildren(el){ while(el && el.firstChild) el.removeChild(el.firstChild); }

/* ---------- final explosion & cats GIF ---------- */
function triggerFinalExplosion(){
  // prevent multiple triggers
  if(window._finalTriggered) return;
  window._finalTriggered = true;

  // remove page content
  p1.style.display = 'none'; p2.style.display = 'none'; p3.style.display = 'none';
  // big TAK center (full)
  const big = document.createElement('div');
  big.className = 'full-tak';
  big.textContent = 'TAK!!!';
  document.body.appendChild(big);

  // spawn many hearts & stars outward
  for(let i=0;i<120;i++){
    const e = document.createElement('div');
    e.className = 'fall';
    e.textContent = (Math.random()>0.45)? '‚ù§Ô∏è' : '‚ú®';
    const size = Math.round(rand(20,72));
    e.style.fontSize = size + 'px';
    // spawn around center region
    e.style.left = (50 + rand(-30,30)) + 'vw';
    e.style.top  = (50 + rand(-30,30)) + 'vh';
    const dur = rand(1.0,2.2);
    e.style.animationDuration = dur + 's';
    e.style.opacity = 1;
    document.body.appendChild(e);
    setTimeout(()=>{ if(e.parentNode) e.parentNode.removeChild(e); }, dur*1000 + 600);
  }

  // small colorful bursts
  for(let i=0;i<18;i++){
    const c = document.createElement('div');
    c.style.position='fixed';
    c.style.left = (50 + rand(-40,40)) + 'vw';
    c.style.top  = (50 + rand(-40,40)) + 'vh';
    const s = Math.round(rand(12,36));
    c.style.width = c.style.height = s + 'px';
    c.style.background = (Math.random()>0.5) ? 'rgba(255,70,120,0.95)' : 'rgba(255,215,60,0.95)';
    c.style.borderRadius='50%';
    c.style.zIndex=1200;
    c.style.opacity=1;
    document.body.appendChild(c);
    const dur = rand(700,1400);
    setTimeout(()=>{ c.style.transition = `transform ${dur}ms ease,opacity ${dur}ms`; c.style.transform = `translateY(${rand(-120,120)}px) scale(2)`; c.style.opacity=0; }, 40);
    setTimeout(()=>{ if(c.parentNode) c.parentNode.removeChild(c); }, dur+400);
  }

  // show cat gif
  catGif.src = "https://media.giphy.com/media/3oriO0OEd9QIDdllqo/giphy.gif";
  catGif.style.display = 'block';
  catGif.style.opacity = '0';
  catGif.style.transition = 'opacity .6s ease';
  setTimeout(()=>catGif.style.opacity='1',120);

  // clicking big restarts
  big.addEventListener('click', ()=> location.reload());
}

/* ---------- init page3 when user reaches it ---------- */
function initPage3(){
  initPage2(); // ensure page2 elements exist (harmless)
  initPage3Once();
}

/* ensure initPage3 only runs once */
let initPage3OnceCalled = false;
function initPage3Once(){
  if(initPage3OnceCalled) return;
  initPage3OnceCalled = true;
  // start page3 logic
  // if user arrived directly (e.g. by previous steps), ensure init
  initPage3();
}

/* expose for debugging */
window._debug = { showPage, triggerFinalExplosion };

/* ensure p1->p2 on load works if user clicks heart1 */
</script>
</body>
</html>
